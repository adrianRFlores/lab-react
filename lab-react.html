<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    	<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    	<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    	<link rel="stylesheet" type="text/css" href="lab-react.css">
    	<title>Memoria</title>
	</head>
	<body>
		<div id="root"></div>

		<script type="text/babel">

			//fisher-yates de mayor a menor para hacerle shuffle al array de imagenes
			function shuffle( arr ) {
  				let i = arr.length, randNum;
  				while (i != 0) {
    				randNum = Math.floor( Math.random() * i )
    				i--
	    			[ arr[i], arr[randNum] ] = [ arr[randNum], arr[i] ]
  				}

  				return arr;
			}

			const CardGrid = () => {

				const initCardArr = [ {uid: 1, imgID: 0, img: './imgs/baldachin.png', state:''}, {uid: 2, imgID: 0, img: './imgs/baldachin.png', state:''},
  							{uid: 3, imgID: 1, img: './imgs/blood2.png', state:''}, {uid: 4, imgID: 1, img: './imgs/blood2.png', state:''},
  							{uid: 5, imgID: 2, img: './imgs/crucible2.png', state:''}, {uid: 6, imgID: 2, img: './imgs/crucible2.png', state:''},
 							{uid: 7, imgID: 3, img: './imgs/dragon2.png', state:''}, {uid: 8, imgID: 3, img: './imgs/dragon2.png', state:''},
  							{uid: 9, imgID: 4, img: './imgs/gravity2.png', state:''}, {uid: 10, imgID: 4, img: './imgs/gravity2.png', state:''},
  							{uid: 11, imgID: 5, img: './imgs/haligtree.png', state:''}, {uid: 12, imgID: 5, img: './imgs/haligtree.png', state:''},
  							{uid: 13, imgID: 6, img: './imgs/golden.png', state:''}, {uid: 14, imgID: 6, img: './imgs/golden.png', state:''},
  							{uid: 15, imgID: 7, img: './imgs/rot2.png', state:''}, {uid: 16, imgID: 7, img: './imgs/rot2.png', state:''} ]

  				const [cardArr, setCardArr] = React.useState( shuffle(initCardArr) )

				const [prevState, setPrevState] = React.useState(-1)
				const prevKey = React.useRef(-1)

				const handleClick = (uid, imgID) => {

					if(key != prevKey.current){

						if(cardArr[key].state === 'active matched'){
							alert('ola matched')
						} else {

							if(prevState === -1){
								prevKey.current = key
								cardArr.status = 'active'
								setCardArr([...cards])
								setPrevState(key)
							} else {
								prevKey.current = -1
							}

						}

					} else {
						alert('ola')
					}

				}

  				return (
  					<div className='card_grid'>
  						{ card.map( (card, key) => {return <Card card={card} key={key} handler={handleClick}/>} ) }
  					</div>
  				)

			}

			const Card = ({card, handler}) => {

				let classname = ''

				if(card.state){ classname = 'active' } else {classname = ''}

				return (
					<div className = {`card ${card.state}`} onClick={() => handler(card.uid, card.imgID)}>
						<div className="card-front"><img src={card.img} alt={card.imgID}/></div>
						<div className="card-back"></div>
					</div>
				)

			}

			const MemGame = () => {
				return (
					<div> <h1>Juego de Memoria</h1> <CardGrid/> </div>
				)
			}

			const root = ReactDOM.createRoot(document.getElementById('root'))
      		root.render(<MemGame />)

		</script>
	</body>

</html>